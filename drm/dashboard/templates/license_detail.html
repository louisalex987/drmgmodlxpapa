{% extends "layout.html" %}

{% block title %}Licence #{{ license.id }}{% endblock %}

{% block content %}
<header>
    <h1>Licence #{{ license.id }}</h1>
    <a href="{{ url_for('dashboard') }}">← Retour au Dashboard</a>
</header>

<div class="grid">
    <section class="card">
        <h2>Informations</h2>
        <div style="display: grid; gap: 10px;">
            <div>
                <label>Clé de licence</label>
                <code style="display: block; padding: 10px; background: #16161e; border-radius: 4px; word-break: break-all;">{{ license.key }}</code>
            </div>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                <div>
                    <label>Client</label>
                    <a href="{{ url_for('client_detail', client_id=license.client_id) }}">{{ license.client_name }}</a>
                </div>
                <div>
                    <label>Addon</label>
                    <span>{{ license.addon_name }}</span>
                </div>
            </div>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                <div>
                    <label>Expiration</label>
                    <span>{{ license.expiration }}</span>
                </div>
                <div>
                    <label>Statut</label>
                    <span>{{ "Actif" if license.active else "Inactif" }}</span>
                </div>
            </div>
        </div>

        <div style="margin-top: 20px; border-top: 1px solid #414868; padding-top: 20px; display: flex; gap: 10px;">
            <form method="post" action="{{ url_for('dash_regen', license_id=license.id) }}" onsubmit="return confirm('Êtes-vous sûr de vouloir régénérer cette clé ? L\'ancienne cessera de fonctionner.');" style="flex: 1;">
                <button type="submit" style="background: #e0af68; color: #1a1b26;">Régénérer la clé</button>
            </form>
            
            {% if license.active %}
                <form method="post" action="{{ url_for('dash_deactivate', license_id=license.id) }}" onsubmit="return confirm('Voulez-vous vraiment désactiver cette licence ?');" style="flex: 1;">
                    <button type="submit" class="btn-danger">Désactiver la licence (Stop)</button>
                </form>
            {% endif %}
        </div>
    </section>

    <section class="card">
        <h2>Logs d'activité</h2>
        <table>
            <thead>
                <tr>
                    <th>Date</th>
                    <th>Status</th>
                    <th>IP</th>
                    <th>Détails</th>
                </tr>
            </thead>
            <tbody>
                {% for log in logs %}
                    <tr>
                        <td>{{ log.timestamp[:19].replace('T', ' ') }}</td>
                        <td>{{ log.status }}</td>
                        <td>{{ log.ip_address }}</td>
                        <td>{{ log.details }}</td>
                    </tr>
                {% else %}
                    <tr><td colspan="4" style="text-align: center; color: #565f89;">Aucun log pour cette licence.</td></tr>
                {% endfor %}
            </tbody>
        </table>
    </section>
</div>
{% endblock %}